-- T033_ASS2_SCRIPT.SQL
-- RONAK SHAH - 4949773
-- MEHRI NIKKHAH - 4978110

--PART 8
--1

SELECT DD.DAYNAME, SUM(DS.QTY*DS.SALEPRICE) AS "TOTAL SALES" 
FROM DWSALE DS 
NATURAL JOIN DWDATE DD
WHERE DS.SALE_DWDATEID = DD.DATEKEY
GROUP BY DD.DAYNAME
ORDER BY 2 DESC;

--2

SELECT DC.CUSTCATNAME, SUM(DS.QTY*DS.SALEPRICE) AS "TOTAL SALES"
FROM DWSALE DS, DWCUST DC
WHERE DS.DWCUSTID = DC.DWCUSTID
GROUP BY DC.CUSTCATNAME
ORDER BY 2 DESC;

--3

SELECT DP.PRODMANUNAME, SUM(DS.QTY)
FROM DWSALE DS
NATURAL JOIN DWPROD DP
GROUP BY DP.PRODMANUNAME
ORDER BY 2 DESC;

--4

SELECT * FROM
(SELECT DC.DWCUSTID, DC.FIRSTNAME, DC.SURNAME, SUM(DS.QTY*DS.SALEPRICE) AS "TOTAL SALES" 
FROM DWSALE DS, DWCUST DC
WHERE DS.DWCUSTID = DC.DWCUSTID 
GROUP BY DC.DWCUSTID, DC.FIRSTNAME, DC.SURNAME
ORDER BY 4 DESC)
WHERE ROWNUM < 11;

--5

SELECT * FROM
(SELECT DP.DWPRODID, DP.PRODNAME, SUM(DS.QTY) AS "TOTAL QTY SALES"
FROM DWSALE DS, DWPROD DP
WHERE DS.DWCUSTID = DP.DWPRODID
GROUP BY DP.DWPRODID,DP.PRODNAME
ORDER BY 3 ASC)
WHERE ROWNUM <= 10;

--6

SELECT STATE, CITY, "TOTAL SALES" FROM (WITH TOP_SALES AS
(SELECT DC.STATE, DC.CITY, SUM(DS.QTY*DS.SALEPRICE) AS "TOTAL SALES", ROW_NUMBER()
OVER (PARTITION BY DC.STATE ORDER BY 3 DESC) AS ROWNUMBER
FROM DWSALE DS, DWCUST DC
WHERE DS.DWCUSTID = DC.DWCUSTID
GROUP BY DC.STATE, DC.CITY
ORDER BY 1 ASC, 3 DESC)
SELECT * FROM TOP_SALES
WHERE (ROWNUMBER < 2));
